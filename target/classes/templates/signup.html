<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Signup Form</title>
  <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
  <link rel="stylesheet" href="/css/css/style.css">
  <script src="/css/js/signup.js" defer></script>
</head>
<body>
<section>
  <form id="signup-form">
    <h1>Sign Up</h1>
    <div class="inputbox">
      <ion-icon name="person-outline"></ion-icon>
      <input type="text" id="login" name="login" required>
      <label for="">Login</label>
    </div>
    <div class="inputbox">
      <ion-icon name="mail-outline"></ion-icon>
      <input type="email" id="email" name="email" required>
      <label for="">Email</label>
    </div>

    <div class="inputbox">
      <ion-icon name="lock-closed-outline"></ion-icon>
      <input type="password" id="password" name="password" required>
      <label for="">Password</label>
    </div>
    <div class="inputbox">
      <ion-icon name="lock-closed-outline"></ion-icon>
      <input type="password" id="passwordcon" name="passwordcon" required>
      <label for="">Confirm Password</label>
    </div>
    <button id="submit" type="submit">Sign Up</button>
    <div class="register">
      <p>Already have an account? <a href="">Log In</a></p>
    </div>
  </form>
</section>
</body>
<script>
  // Обработчик отправки формы
  document.getElementById("signup-form").addEventListener('submit', function(e) {
    e.preventDefault(); // Останавливаем стандартную отправку формы

    // Сбор данных с формы
    const login = document.getElementById('login').value;
    const password = document.getElementById('password').value;
    const confirmPassword = document.getElementById('passwordcon').value;
    const email = document.getElementById('email').value;

    // Проверка на совпадение паролей
    if (password !== confirmPassword) {
      alert("Passwords do not match");
      return;
    }
    // Создание объекта данных для отправки
    const data = {
      login: login, // Название поля должно быть 'login' в MyUser
      email,
      password
    };

    // Отправка данных на сервер
    fetch('/req/signup', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(data),
    })
            .then(response => response.json())  // Ответ сервера в формате JSON
            .then(data => {
              if (data.success) {
                // Успешная регистрация
                alert('Registration successful');
                window.location.href = '/login';  // Переход на страницу входа
              }
            })
            .catch(error => {
              // Ошибка при отправке запроса
              console.error('Error during registration:', error);
              alert('An error occurred during registration. Please try again later.');
            });
  });
</script>
</html>